## Pages used to make these notes
- [Managing secrets](https://kubernetes.io/docs/tasks/configmap-secret/)

## Secret management with kubectl
Secrets are k8s object resources.  Create them using the `kubectl create secret` command.  Its synopsis is
```
kubectl create secret (docker-registry | generic | tls) [options]
```
which shows there are three types of secrets.  With `docker-registry` or `generic`, data can be passed inline in the creation command or by specifying a filepath to a file containing the data.  Simple usage of `kubectl create secret generic` shows
```
kubectl create secret generic NAME [--from-file=[key=]source] [--from-literal=key1=value1] [options]
```
Create a generic secret with inline values like so
```
kubectl create secret generic my-secret-app-creds --from-literal=username=admin --from-literal=password=my-secret-password-value
```
Create a generic secret with values from files to make an 'equivalent' secret object to the above like so
```
$ echo -n admin > username.txt
$ echo -n my-secret-password-value > pswd.txt
$ kubectl create secret generic my-secret-app-creds-2 --from-file=username=username.txt --from-file=password=pswd.txt
```
If you don't specify a key like `--from-file=<key>=<file-path>`, it will use the full name of the file (including the extension but not including the full path) as the key by default.

View contents of a Secret with the output format `-o` flag for the `kubectl get` command.  The contents are base64 encoded.  You can pipe the output of the `get -o` command into `base64 --decode` to avoid secrets being in shell history.  You can use `kubectl explain` to show the structure of object resources to then specify properties to display with `kubectl get --output`.  For example, running `kubectl describe secret my-secret-app-creds-2` shows
```
<...>
Data
====
password:  24 bytes
username:  5 bytes
```
Then running `kubectl explain secret` shows
```
<...>
FIELDS:
  <...>
  data	<map[string]string>
    <...>
```
`kubectl explain --recursive` can be used to show a full nested object structure rather than just the top level properties on the object in the case that complex object types are top level properties of the object in question.  Alternative, running `kubectl get ... -o json` will display the full JSON object for the resource.  So, you can then run
```
kubectl get secret my-secret-app-creds-2 -o jsonpath='{.data.password}' | base64 --decode
```
to return just the decoded base64 secret value from the secret object.

Secrets can be edited with `kubectl edit secret <secret-name>`.  It will open an editor to the manifest file for that secret object.  To change the secret value, you'll have to put in a new base64 encoded value, not a plaintext value, unless you use the `stringData` field which reflects the structure of `data` but uses plaintext instead of base64.  A `stringData` key/value will take precedence over a `data` key/value when the keys match.

## Secret management with configuration files

Create a Secret object with a manifest file like so
```

```
It is essentially the same as editing the manifest when editing the secret with `kubectl edit`.  Create the Secret from the manifest with `kubectl apply -f <manifest-path>`.  Run the same command again to apply any edited updates to the manifest.

## Secret management with Kustomize